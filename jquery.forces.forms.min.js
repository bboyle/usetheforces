/*
 * usetheforces
 * @see http://usetheforces.googlecode.com/
 * @license GNU GENERAL PUBLIC LICENSE Version 3 <http://www.gnu.org/licenses/gpl.html>
 * @requires jQuery
 */
if(typeof(jQuery)!="undefined"){(function(c){var a=c.forces=c.forces||{};var f="January February March April May June July August September October November December".split(/ /);var e="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(/ /);var b=new Date();var d=function(h,g,i){h=String(h);while(h.length<g){h=String(i)+h}return h};a.dateFormat=function(g,h){if(!g){return""}if(!h){return g.toString()}return h.replace(/YYYY|yyyy|%Y/,g.getFullYear()).replace(/MM|%m/,d(g.getMonth()+1,2,"0")).replace(/dd|%d/,d(g.getDate(),2,"0")).replace(/%e/,d(g.getDate(),2," ")).replace(/d/,g.getDate()).replace(/%B/,f[g.getMonth()]).replace(/%A/,e[g.getDay()])};a.dateParse=function(p,j,m){p=p.split(/[^A-Za-z0-9]/);var g=j||m||b;var h={};function n(q,i){h[q]=h[q]||i}for(var k=0;k<p.length;k++){if(p[k].match(/^\d{4}$/)){n("year",p[k])}else{if(p[k].match(/^\d{1,2}$/)){var o=h.date?(h.month?"year":"month"):"date";if(o=="year"&&!h.year){p[k]=(g.getFullYear()+"").substring(0,2)+d(p[k],2,"0");if(j&&j.getFullYear()>p[k]){p[k]+=100}else{if(m&&m.getFullYear()<p[k]){p[k]-=100}else{if(!j&&!m&&p[k]>g.getFullYear()+20){p[k]-=100}}}}n(o,p[k])}}}if(h.date&&h.month&&h.year){var l=new Date(h.year,h.month-1,h.date);if(a.dateEquals(l,h.year,h.month,h.date)){return l}}return null};a.dateCalc=function(g,h){h=c.extend({year:0,month:0,date:0},h);return new Date(g.getFullYear()+h.year,g.getMonth()+h.month,g.getDate()+h.date)};a.dateEquals=function(h,j,g,i){return(h.getMonth()==g-1&&h.getDate()==i&&h.getFullYear()==j)};a.dateEndOfMonth=function(g){g=new Date(g.getFullYear(),g.getMonth(),31);if(g.getDate()!=31){g.setDate(31-g.getDate());g=this.dateCalc(g,{month:-1})}return g};a.DATE_TODAY=function(){return new Date(b.getFullYear(),b.getMonth(),b.getDate())};a.WEEKDAYS=function(){return e.slice()}})(jQuery)}if(typeof(jQuery)!="undefined"){(function(c){var a=c.forces=c.forces||{};var b=0;a.generateId=function(){return"tf-ID-"+ ++b}})(jQuery)}if(typeof(jQuery)!="undefined"){(function(b){var a=b.forces=b.forces||{};b.fn.forces_id=function(d){var c=b(this);if(!d||document.getElementById(d)){d=a.generateId()}return c.attr("id")||c.attr("id",d).attr("id")}})(jQuery)}if(typeof(jQuery)!="undefined"){(function(b){var a=b.forces=b.forces||{};b.fn.scrollTo=function(c){c=b.extend({hash:false,focus:false,distance:1},c);var d=b(this).eq(0);if(c.hash===true){location.hash=d.forces_id()}else{if(typeof c.hash==="object"){location.hash=c.hash.forces_id()}}if(c.focus===true){d.focus()}else{if(typeof c.focus=="object"){c.focus.focus()}}if(c.ancestor){d=d.closest(c.ancestor)}b("html,body").animate({scrollTop:d.offset().top-c.distance},100);return b(this)},b.fn.shake=function(c){c=b.extend({interval:75,distance:10,shakes:2},c);var d=b(this);var f=parseInt(d.css("marginLeft"))||0;var g=parseInt(d.css("marginRight"))||0;for(var e=0;e<c.shakes;e++){d.animate({marginLeft:f-c.distance,marginRight:g+c.distance},c.interval).animate({marginLeft:f+c.distance,marginRight:g-c.distance},c.interval)}return d.animate({marginLeft:f,marginRight:g},c.interval)}})(jQuery)}if(typeof(jQuery)!="undefined"){(function(e){var c=e.forces=e.extend(e.forces||{},{EVENT_XF_DISABLED:"-xf-disabled",EVENT_XF_ENABLED:"-xf-enabled",EVENT_XF_FOCUS_IN:"-xf-focus-in",EVENT_XF_FOCUS_OUT:"-xf-focus-out",EVENT_XF_OPTIONAL:"-xf-optional",EVENT_XF_REQUIRED:"-xf-required",EVENT_XF_VALID:"-xf-valid",EVENT_XF_INVALID:"-xf-invalid",EVENT_XF_VALUE_CHANGED:"-xf-value-changed",EVENT_XF_SUBMIT_DONE:"-xf-submit-done",EVENT_XF_SUBMIT_ERROR:"-xf-submit-error",EVENT_TF_SUBMIT_SUPPRESSED:"-tf-submit-suppressed",EXPR_HTML_CONTROLS:":text,select,textarea,.xf-select1 fieldset",REXP_EMAIL:/^[A-Za-z!#$%&'*+-\/=?^_`{|}~\.]+@[A-Za-z0-9-]*[A-Za-z0-9]+(?:\.[A-Za-z0-9-]*[A-Za-z0-9]+)+$/,REXP_NUMBER:/^[0-9]+$/,SUBMIT_TOLERANCE:10000});var d="-tf-submitted";e.extend(e.expr[":"],{"-tf-not-validated":function(f){return(e(f).data("-tf-FLAGS")&48)==0},"-xf-empty":function(f){return e.trim(e(f).forces_val()).length==0},"-xf-non-empty":function(f){return e.trim(e(f).forces_val()).length>0},"-xf-invalid":function(f){return(e(f).data("-tf-FLAGS")&32)==32},"-xf-irrelevant":function(f){return(e(f).data("-tf-FLAGS")&1)==1},"-xf-optional":function(f){return(e(f).data("-tf-FLAGS")&4)==0},"-xf-relevant":function(f){return(e(f).data("-tf-FLAGS")&1)==0},"-xf-required":function(f){return(e(f).data("-tf-FLAGS")&4)==4},"-xf-valid":function(f){return(e(f).data("-tf-FLAGS")&16)==16}});e.fn.forces_attr=function(f,g){if(typeof(g)=="undefined"){g=this.data("-tf-@"+f);return g?g:(this.is(":-xf-"+f)?f:null)}switch(f){case"relevant":this.forces__flags(2,g!==true&&g!="relevant");break;case"required":this.forces__flags(8,g===true||g=="required");break;case"type":break;default:return this}return this.data("-tf-@"+f,g===true?f:g).forces_recalculate()};e.fn.forces_removeAttr=function(f){switch(f){case"relevant":this.forces__flags(2,false);break;case"required":this.forces__flags(8,false);break;case"type":break;default:return this}return this.removeData("-tf-@"+f).forces_recalculate()};e.fn.forces_val=function(){var f=e(this);return f.val()||f.find(":checked").val()||null};e.fn.forces_setCustomValidity=function(f){return e(this).data("-tf-CUSTOM-VALIDITY",f)},e.fn.forces_validationMessage=function(){return e(this).data("-tf-CUSTOM-VALIDITY")||""},e.fn.forces_isConfirmationFor=function(g){var f=e(this);if(g){g=e(g);return f.data("-tf-CONFIRMS",g.data("-tf-VALIDATE",f))}else{return f.data("-tf-CONFIRMS")}};e.fn.forces_recalculate=function(){var h,g;var i=function(k,f,l,j){k.forces__flags(f,l).trigger(j)};return this.each(function(){h=e(this);g=h.data("-tf-FLAGS")||0;switch(g&3){case 2:i(h,1,true,c.EVENT_XF_DISABLED);break;case 1:i(h,1,false,c.EVENT_XF_ENABLED);break}switch(g&12){case 8:i(h,4,true,c.EVENT_XF_REQUIRED);break;case 4:i(h,4,false,c.EVENT_XF_OPTIONAL);break}})};e.fn.forces_validate=function(){return e(this).filter(function(){var i=e(this);var g=i.data("-tf-CUSTOM-VALIDITY")?false:true;var h=e.trim(i.forces_val());if(g&&h){switch(i.forces_attr("type")){case"email":g=c.REXP_EMAIL.exec(h);break;case"date":g=c.dateParse(h);break;case"number":g=c.REXP_NUMBER.exec(h);break}var f=i.forces_isConfirmationFor();if(f){g=e.trim(f.val())==h}}else{if(i.is(":-xf-required")){g=false}}if(g){i.forces__flags(32,false).forces__flags(16,true).trigger(c.EVENT_XF_VALID)}else{i.forces__flags(16,false).forces__flags(32,true).trigger(c.EVENT_XF_INVALID)}return !g})};e.fn.forces__flags=function(f,h){var g;this.set=function(){g=e(this);g.data("-tf-FLAGS",g.data("-tf-FLAGS")|f)};this.unset=function(){g=e(this);g.data("-tf-FLAGS",g.data("-tf-FLAGS")&~f)};return h?this.each(this.set):this.each(this.unset)};var a=function(f){var g=e(this);if(true){if(g.data(d)&&f.timeStamp-g.data(d)<c.SUBMIT_TOLERANCE){f.stopImmediatePropagation();g.trigger(c.EVENT_TF_SUBMIT_SUPPRESSED);return false}g.data(d,f.timeStamp);if(g.find(c.EXPR_HTML_CONTROLS).forces_validate().length){g.trigger(c.EVENT_XF_SUBMIT_ERROR);g.removeData(d);return false}}g.trigger(c.EVENT_XF_SUBMIT_DONE);return true};var b=function(f){var h=e(f.target);switch(f.type){case"click":case"focus":case"mousedown":h.data("-tf-VALUE",h.val()).trigger(c.EVENT_XF_FOCUS_IN);break;case"blur":var g=h.data("-tf-VALUE");h.removeData("-tf-VALUE").trigger(c.EVENT_XF_FOCUS_OUT);if(h.val()!==g){h.trigger(c.EVENT_XF_VALUE_CHANGED).add(e(h.data("-tf-VALIDATE")).not(":-tf-not-validated:-xf-empty")).forces_validate()}break}};e.fn.forces_enable=function(f){c.toggleFormHandlers(f,e(this))};c.toggleFormHandlers=function(f,g){g=g||e("form");if(f||f===undefined){g.bind("submit",a);e("input,select,textarea",g).bind("focus blur click mousedown",b)}else{g.unbind("submit",a);e("input,select,textarea",g).unbind("focus blur click mousedown",b)}}})(jQuery)}if(typeof(jQuery)!="undefined"){(function(b){var a=b.forces=b.extend(b.forces||{},{CSS_ACTIVE:"tf-active",CSS_ALERT:"xf-alert",CSS_INVALID:"xf-invalid",CSS_MISSING:"tf-missing",CSS_REQUIRED:"xf-required",CSS_SUBMIT_DONE:"xf-submit-done",CSS_SUBMIT_ERROR:"xf-submit-error",CSS_VALID:"xf-valid",MSG_INVALID:"is invalid",MSG_INVALID_DATE:"unrecognised date format",MSG_INVALID_EMAIL:"must contain an email address",MSG_INVALID_CONFIRM:"doesn't match ",MSG_INVALID_NUMBER:"must contain only digits",MSG_MISSING:"must be completed",MSG_SUBMIT_ERROR:"Unable to process this form",HTML_ALERT_INLINE:function(d){return b("<em></em>").addClass(this.CSS_ALERT).text(d)},HTML_REQUIRED:function(){return b(document.createElement("abbr")).addClass(this.CSS_REQUIRED).attr("title","required").text("*")},HTML_STATUS:function(){return b('<div class="tf-status"><div class="tf-alert inner"><h1>'+this.MSG_SUBMIT_ERROR+"</h1><ol></ol></div></div>")},MS_ENABLE:300,MS_DISABLE:0});var c="-tfui-status";b.extend(b.expr[":"],{"-tf-form":function(d){return b(d).is(".tf-form")},"-xf-control":function(d){return b(d).is(".xf-input,.xf-select,.xf-select1,.xf-textarea")},"-xf-group":function(d){return b(d).is(".xf-group")},"-xf-label":function(d){return b(d).is(".xf-label")}});b.fn.forces_alert=function(e){var f=b(this);var d=f.closest(":-xf-control");d.find(".xf-alert").remove();if(e){d.map(function(){var g=b(this).children("fieldset");return g.length==1?g.get(0):this}).append(a.HTML_ALERT_INLINE(e))}return f};a.HTML_CALENDAR=function(e){e=b.extend({date:a.DATE_TODAY()},e);var h=b('<table class="tf-calendar"><caption>'+a.dateFormat(e.date,"%B %Y")+"</caption><thead><tr></tr></thead><tbody></tbody></table>").data("-tf-date-seed",new Date(e.date.getTime()));var j=new Date(e.date.getTime());j.setDate(1);j=j.getDay();var k="<tr>"+(j>0?'<td colspan="'+j+'"></td>':"")+"<td>1</td>";var g=a.dateEndOfMonth(e.date);for(var f=2;f<g.getDate();f++){if((j+f)%7==1){k+="</tr><tr>"}k+="<td>"+f+"</td>"}switch(g.getDay()){case 6:k+="<td>"+g.getDate()+"</td>";break;case 5:k+="<td>"+g.getDate()+"</td><td></td>";break;case 0:k+="</tr><tr>";default:k+="<td>"+g.getDate()+'</td><td colspan="'+(6-g.getDay())+'"></td>'}h.find("tbody").html(k+"</tr>");var d=a.WEEKDAYS();for(var f=0;f<7;f++){h.find("thead tr").append('<th scope="col" title="'+d[f]+'">'+d[f].substr(0,1)+"</th>")}return h};b(":-xf-control").live(a.EVENT_XF_REQUIRED,function(){b(this).find(".xf-required").remove().end().find(":-xf-label").after(a.HTML_REQUIRED())}).live(a.EVENT_XF_OPTIONAL,function(){b(this).removeClass(a.CSS_MISSING).find(".xf-required").remove()}).live(a.EVENT_XF_VALID,function(){b(this).forces_alert().removeClass(a.CSS_INVALID).addClass(a.CSS_VALID)}).live(a.EVENT_XF_INVALID,function(){var h=b(this);var f=h.find("fieldset,input,select,textarea").forces_validationMessage();if(!f){var d=h.find(":text").forces_attr("type");switch(d){case"email":f=a.MSG_INVALID_EMAIL;break;case"date":f=a.MSG_INVALID_DATE;break;case"number":f=a.MSG_INVALID_NUMBER;break;default:var g=h.find("input,select,textarea");var e=g.forces_isConfirmationFor();if(e){f=a.MSG_INVALID_CONFIRM+e.closest(":-xf-control").find(":-xf-label").text().replace(/[?: ]*$/,"")}else{if(g.is(":-xf-empty")){f=a.MSG_MISSING}else{f="invalid"}}}}h.removeClass(a.CSS_VALID).addClass(a.CSS_INVALID).forces_alert(f)}).live(a.EVENT_XF_FOCUS_IN,function(){var e=b(this);var d=e.closest(":-xf-group");e.closest("form").find("."+a.CSS_ACTIVE).not(e,d).removeClass(a.CSS_ACTIVE);e.add(d).addClass(a.CSS_ACTIVE)});b(":-xf-control, :-xf-group, .section").live(a.EVENT_XF_ENABLED,function(){b(this).find(a.EXPR_HTML_CONTROLS).each(function(){this.removeAttribute("disabled")}).end().stop(true,true).slideDown(a.MS_ENABLE)}).live(a.EVENT_XF_DISABLED,function(){b(this).find(a.EXPR_HTML_CONTROLS).each(function(){this.setAttribute("disabled","disabled")}).end().stop(true,true).hide(a.MS_DISABLE)});b(":-tf-form").live(a.EVENT_XF_SUBMIT_ERROR,function(){var f=b(this);var e=f.find(a.EXPR_HTML_CONTROLS);var d=f.data(c)||f.data(c,a.HTML_STATUS()).data(c);var h=b("<ol></ol>");var g;e.filter(":-xf-invalid").each(function(){var k=b(this);var j=k.forces_isConfirmationFor();if(g=k.forces_validationMessage()){}else{if(k.is(":-xf-empty")){g=a.MSG_MISSING}else{if(j){g=a.MSG_INVALID_CONFIRM+j.closest(":-xf-control").find(":-xf-label").text().replace(/[?: ]*$/,"")}else{switch(k.forces_attr("type")){case"date":g=a.MSG_INVALID_DATE;break;case"email":g=a.MSG_INVALID_EMAIL;break;case"number":g=a.MSG_INVALID_NUMBER;break}}}}var i=b('<a href="#'+k.forces_id()+'">'+k.closest(":-xf-control").find(":-xf-label").text().replace(/[?:]*$/,": ")+g+"</a>");h.append(b("<li></li>").append(i));g=a.MSG_INVALID});f.addClass(a.CSS_SUBMIT_ERROR).before(d.find("ol").replaceWith(h).end().fadeIn(300));d.forces_id("status-alert");d.scrollTo({hash:true,focus:true}).shake({interval:250,distance:8,shakes:1});e.filter(":-xf-required:not(:-xf-empty,:-xf-invalid)").forces_alert();e.filter(":-xf-required:not(:-xf-empty)").closest(":-xf-control").removeClass(a.CSS_MISSING);e.filter(":-xf-required:-xf-empty").closest(":-xf-control").addClass(a.CSS_MISSING).forces_alert(a.MSG_MISSING)}).live(a.EVENT_TF_SUBMIT_SUPPRESSED,function(){b(this).find(":submit").shake({interval:75,distance:4,shakes:2})}).live(a.EVENT_XF_SUBMIT_DONE,function(){var d=b(this);if(d.data(c)){d.data(c).remove()}d.removeClass(a.CSS_SUBMIT_ERROR).addClass(a.CSS_SUBMIT_DONE)});b(".tf-alert a").live("click",function(){var d=b(this).attr("href");if(d.indexOf("#")<0){return true}b(d.substring(d.indexOf("#"))).scrollTo({ancestor:":-xf-control",hash:true,focus:true});return false});b(".usetheforces").forces_enable(true);b(".xf-required").closest(":-xf-control").find(a.EXPR_HTML_CONTROLS).forces_attr("required",true)})(jQuery)};